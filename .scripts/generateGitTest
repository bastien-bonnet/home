#!/bin/bash

TEST_DIR="$(pwd)/gitTest"
USER1_NAME="Bastien"
USER2_NAME="Thomas"
USER1_MACHINE="$TEST_DIR/$USER1_NAME"
USER2_MACHINE="$TEST_DIR/$USER2_NAME"
CENTRAL_MACHINE="$TEST_DIR/central"
PROJECT_NAME="project"


# Make all directories to simulate a central repo and 2 user machines
[ -d $TEST_DIR ] && rm -rf $TEST_DIR
mkdir -p $CENTRAL_MACHINE $USER1_MACHINE $USER2_MACHINE
git init --bare $CENTRAL_MACHINE/"$PROJECT_NAME".git
git clone -c user.name=$USER1_NAME $CENTRAL_MACHINE/$PROJECT_NAME $USER1_MACHINE/$PROJECT_NAME
git clone -c user.name=$USER2_NAME $CENTRAL_MACHINE/$PROJECT_NAME $USER2_MACHINE/$PROJECT_NAME

# Make a few commits on master from USER1
SAMPLE_TEXT_FILE=a.txt
touch $USER1_MACHINE/$PROJECT_NAME/$SAMPLE_TEXT_FILE
cd $USER1_MACHINE/$PROJECT_NAME \
&& git add $SAMPLE_TEXT_FILE \
&& export GIT_AUTHOR_DATE="2015-09-14T09:00:02" \
&& export GIT_COMMITTER_DATE="2015-09-14T09:01:35" \
&& git commit -am "Initial commit" \
&& echo 'work' >> $SAMPLE_TEXT_FILE \
&& export GIT_AUTHOR_DATE="2015-10-18T11:08:22" \
&& export GIT_COMMITTER_DATE="2015-10-18T11:11:45" \
&& git commit -am "Modify $SAMPLE_TEXT_FILE" \
&& echo -e "#!/bin/bash\n\necho hello" > b.txt \
&& git add -A \
&& export GIT_AUTHOR_DATE="2015-10-21T14:10:20" \
&& export GIT_COMMITTER_DATE="2015-10-21T15:12:21" \
&& git commit -m "Add powerful script" \
&& git push

# Make a new branch by USER2
cd $USER2_MACHINE/$PROJECT_NAME \
&& git pull \
&& git checkout -b featureF master^ \
&& touch featureF_part1.txt \
&& echo -e "\nLigne pour la feature F" >> a.txt \
&& git add -A \
&& export GIT_AUTHOR_DATE="2015-10-22T09:00:02" \
&& export GIT_COMMITTER_DATE="2015-10-22T09:01:35" \
&& git commit -m "DÃ©but de la feature F" \
&& git push --set-upstream origin featureF
